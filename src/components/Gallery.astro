---
import { getCollection } from "astro:content"
import { Image } from "astro:assets"
import Dialog from "./Dialog.astro"

const gallery = await getCollection("gallery")
---

<div
	class="columns-1 gap-4 bg-neutral-800 p-4 py-2 sm:columns-2 md:gap-6 md:px-6 md:py-3 lg:columns-3 lg:gap-8 lg:px-8 lg:py-4 xl:columns-4">
	{
		gallery
			.sort((a, b) => a.data.sortOrder - b.data.sortOrder)
			.map((item) => (
				<button class="py-2 md:py-3 lg:py-4" type="button" data-dialog={`dlg_${item.id}`}>
					<Image
						class="rounded-md md:rounded-lg lg:rounded-xl"
						src={item.data.image}
						alt={`${item.data.role} in ${item.data.play} by ${item.data.author}`}
						widths={[280, 360, 384, 476, 607]}
						sizes={`(min-width: 1280px) 280px, (min-width: 1024px) 384px, (min-width: 768px) 476px, (min-width: 640px) 360px, 100vw`}
					/>
				</button>
			))
	}
</div>
{
	gallery.map((item) => (
		<Dialog
			id={`dlg_${item.id}`}
			part={item.data.role}
			play={item.data.play}
			author={item.data.author}>
			<Image
				class="h-full max-h-[70dvh] w-full object-scale-down"
				src={item.data.image}
				alt={`${item.data.role} in ${item.data.play} by ${item.data.author}`}
				widths={[362, 570, 691, 768, 1152]}
				sizes={`(min-width: 1280px) 1152px, 90vw`}
				loading={"eager"}
			/>
		</Dialog>
	))
}

<script>
	const buttons = document.querySelectorAll("button[data-dialog]")
	if (buttons && buttons.length > 0) {
		for (const button of buttons) {
			button.addEventListener("click", (e: Event) => {
				const btn = e.currentTarget as HTMLButtonElement
				const dialog = document.getElementById(btn.dataset.dialog as string) as HTMLDialogElement
				dialog!.showModal()
			})
		}
	}
</script>
